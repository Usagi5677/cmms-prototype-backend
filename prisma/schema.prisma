// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator dbml {
  provider = "prisma-dbml-generator"
}

model User {
  id                                           Int                                 @id @default(autoincrement())
  createdAt                                    DateTime                            @default(now())
  updatedAt                                    DateTime                            @updatedAt
  userId                                       String                              @unique
  rcno                                         Int
  fullName                                     String
  email                                        String
  notifications                                Notification[]
  roles                                        UserRole[]
  machineCreated                               Machine[]
  machineAssignments                           MachineAssignment[]
  machineAttachments                           MachineAttachment[]
  machineChecklistCompletions                  MachineChecklistItem[]
  machinePeriodicMaintenanceCompletions        MachinePeriodicMaintenance[]
  MachineRepairs                               MachineRepair[]
  MachineBreakdowns                            MachineBreakdown[]
  MachineSparePRs                              MachineSparePR[]
  MachineHistories                             MachineHistory[]
  transportationCreated                        Transportation[]
  transportationAssignments                    TransportationAssignment[]
  transportAttachments                         TransportationAttachment[]
  transportationChecklistCompletions           TransportationChecklistItem[]
  transportationPeriodicMaintenanceCompletions TransportationPeriodicMaintenance[]
  TransportationRepairs                        TransportationRepair[]
  TransportationBreakdowns                     TransportationBreakdown[]
  TransportationSparePRs                       TransportationSparePR[]
  TransportationHistories                      TransportationHistory[]
  roleCreated                                  Role[]
}

model Notification {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  userId    Int
  user      User      @relation(fields: [userId], references: [id])
  body      String?
  link      String?
  readAt    DateTime?
}

enum Permission {
  ADD_ROLE
  EDIT_ROLE
  DELETE_ROLE
  ADD_MACHINE
  EDIT_MACHINE
  DELETE_MACHINE
  ADD_MACHINE_CHECKLIST
  EDIT_MACHINE_CHECKLIST
  DELETE_MACHINE_CHECKLIST
  ADD_MACHINE_PERIODIC_MAINTENANCE
  EDIT_MACHINE_PERIODIC_MAINTENANCE
  DELETE_MACHINE_PERIODIC_MAINTENANCE
  ADD_MACHINE_SPARE_PR
  EDIT_MACHINE_SPARE_PR
  DELETE_MACHINE_SPARE_PR
  ADD_MACHINE_REPAIR
  EDIT_MACHINE_REPAIR
  DELETE_MACHINE_REPAIR
  ADD_MACHINE_BREAKDOWN
  EDIT_MACHINE_BREAKDOWN
  DELETE_MACHINE_BREAKDOWN
  ADD_MACHINE_ATTACHMENT
  EDIT_MACHINE_ATTACHMENT
  DELETE_MACHINE_ATTACHMENT
  ADD_TRANSPORTATION
  EDIT_TRANSPORTATION
  DELETE_TRANSPORTATION
  ADD_TRANSPORTATION_CHECKLIST
  EDIT_TRANSPORTATION_CHECKLIST
  DELETE_TRANSPORTATION_CHECKLIST
  ADD_TRANSPORTATION_PERIODIC_MAINTENANCE
  EDIT_TRANSPORTATION_PERIODIC_MAINTENANCE
  DELETE_TRANSPORTATION_PERIODIC_MAINTENANCE
  ADD_TRANSPORTATION_SPARE_PR
  EDIT_TRANSPORTATION_SPARE_PR
  DELETE_TRANSPORTATION_SPARE_PR
  ADD_TRANSPORTATION_REPAIR
  EDIT_TRANSPORTATION_REPAIR
  DELETE_TRANSPORTATION_REPAIR
  ADD_TRANSPORTATION_BREAKDOWN
  EDIT_TRANSPORTATION_BREAKDOWN
  DELETE_TRANSPORTATION_BREAKDOWN
  ADD_TRANSPORTATION_ATTACHMENT
  EDIT_TRANSPORTATION_ATTACHMENT
  DELETE_TRANSPORTATION_ATTACHMENT
  ASSIGN_USER_TO_MACHINE
  UNASSIGN_USER_TO_MACHINE
  ASSIGN_USER_TO_TRANSPORTATION
  UNASSIGN_USER_TO_TRANSPORTATION
  EDIT_MACHINE_USAGE
  EDIT_TRANSPORTATION_USAGE
  ASSIGN_PERMISSION
  ADD_USER_WITH_ROLE
  EDIT_USER_ROLE
  VIEW_ALL_MACHINES
  VIEW_ALL_VESSELS
  VIEW_ALL_VEHICLES
  VIEW_MACHINE
  VIEW_VESSEL
  VIEW_VEHICLE
  VIEW_ALL_ASSIGNED_MACHINES
  VIEW_ALL_ASSIGNED_VESSELS
  VIEW_ALL_ASSIGNED_VEHICLES
  VIEW_USERS
  VIEW_ROLES
  VIEW_MACHINERY_REPORT
  VIEW_TRANSPORTATION_REPORT
}

model Role {
  id              Int              @id @default(autoincrement())
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  name            String
  createdById     Int
  createdBy       User             @relation(fields: [createdById], references: [id])
  userRoles       UserRole[]
  permissionRoles PermissionRole[]
}

model UserRole {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    Int
  roleId    Int
  user      User     @relation(fields: [userId], references: [id])
  role      Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
}

model PermissionRole {
  id         Int        @id @default(autoincrement())
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  roleId     Int
  permission Permission
  role       Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permission])
}

model Machine {
  id                       Int                          @id @default(autoincrement())
  createdAt                DateTime                     @default(now())
  updatedAt                DateTime                     @updatedAt
  createdById              Int
  createdBy                User                         @relation(fields: [createdById], references: [id])
  machineNumber            String
  registeredDate           DateTime?
  model                    String
  type                     String
  zone                     String
  location                 String
  currentRunningHrs        Int?
  lastServiceHrs           Int?
  interServiceHrs          Int?
  status                   MachineStatus                @default(Working)
  statusChangedAt          DateTime?
  assignees                MachineAssignment[]
  checklistItems           MachineChecklistItem[]
  periodicMaintenancePlans MachinePeriodicMaintenance[]
  histories                MachineHistory[]
  attachments              MachineAttachment[]
  repairs                  MachineRepair[]
  breakdowns               MachineBreakdown[]
  sparePRs                 MachineSparePR[]
}

enum MachineStatus {
  Working
  Idle
  Breakdown
}

enum SparePRStatus {
  Done
  Pending
}

enum RepairStatus {
  Done
  Pending
}

enum BreakdownStatus {
  Done
  Pending
  Breakdown
}

enum PeriodicMaintenanceStatus {
  Done
  Pending
  Missed
}

model MachineAssignment {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  machineId Int
  machine   Machine  @relation(fields: [machineId], references: [id], onDelete: Cascade)

  @@unique([userId, machineId])
}

model MachineAttachment {
  id                 Int      @id @default(autoincrement())
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  userId             Int
  user               User     @relation(fields: [userId], references: [id])
  machineId          Int
  machine            Machine  @relation(fields: [machineId], references: [id], onDelete: Cascade)
  description        String
  mimeType           String?
  originalName       String?
  sharepointFileName String?
  mode               String   @default("Public")
}

model MachineChecklistItem {
  id            Int       @id @default(autoincrement())
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  machineId     Int
  machine       Machine   @relation(fields: [machineId], references: [id], onDelete: Cascade)
  description   String
  completedById Int?
  completedBy   User?     @relation(fields: [completedById], references: [id])
  completedAt   DateTime?
  type          String    @default("Daily")
}

model MachinePeriodicMaintenance {
  id                   Int                       @id @default(autoincrement())
  createdAt            DateTime                  @default(now())
  updatedAt            DateTime                  @updatedAt
  machineId            Int
  machine              Machine                   @relation(fields: [machineId], references: [id], onDelete: Cascade)
  title                String
  description          String
  period               Int?
  notificationReminder Int?
  fixedDate            DateTime?
  completedById        Int?
  completedBy          User?                     @relation(fields: [completedById], references: [id])
  completedAt          DateTime?
  status               PeriodicMaintenanceStatus @default(Pending)
}

model MachineHistory {
  id                Int            @id @default(autoincrement())
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  machineId         Int
  machine           Machine        @relation(fields: [machineId], references: [id], onDelete: Cascade)
  completedById     Int?
  completedBy       User?          @relation(fields: [completedById], references: [id])
  type              String
  description       String
  machineStatus     MachineStatus?
  machineType       String?
  currentRunningHrs Int?
  lastServiceHrs    Int?
  interServiceHrs   Int?

}

model MachineRepair {
  id            Int          @id @default(autoincrement())
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  machineId     Int
  machine       Machine      @relation(fields: [machineId], references: [id], onDelete: Cascade)
  title         String
  description   String
  completedById Int?
  completedBy   User?        @relation(fields: [completedById], references: [id])
  completedAt   DateTime?
  status        RepairStatus @default(Pending)
}

model MachineBreakdown {
  id            Int             @id @default(autoincrement())
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  machineId     Int
  machine       Machine         @relation(fields: [machineId], references: [id], onDelete: Cascade)
  title         String
  description   String
  completedById Int?
  completedBy   User?           @relation(fields: [completedById], references: [id])
  completedAt   DateTime?
  status        BreakdownStatus @default(Breakdown)
}

model MachineSparePR {
  id            Int           @id @default(autoincrement())
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  machineId     Int
  machine       Machine       @relation(fields: [machineId], references: [id], onDelete: Cascade)
  requestedDate DateTime
  title         String
  description   String
  completedById Int?
  completedBy   User?         @relation(fields: [completedById], references: [id])
  completedAt   DateTime?
  status        SparePRStatus @default(Pending)
}

model Transportation {
  id                       Int                                 @id @default(autoincrement())
  createdAt                DateTime                            @default(now())
  updatedAt                DateTime                            @updatedAt
  createdById              Int
  createdBy                User                                @relation(fields: [createdById], references: [id])
  machineNumber            String
  registeredDate           DateTime?
  model                    String?
  type                     String?
  location                 String
  status                   TransportationStatus                @default(Working)
  statusChangedAt          DateTime?
  department               String?
  engine                   String?
  currentMileage           Int?
  lastServiceMileage       Int?
  interServiceMileage      Int?
  measurement              String?                             @default("km")
  transportType            String?                             @default("Vehicle")
  assignees                TransportationAssignment[]
  checklistItems           TransportationChecklistItem[]
  periodicMaintenancePlans TransportationPeriodicMaintenance[]
  attachments              TransportationAttachment[]
  histories                TransportationHistory[]
  repairs                  TransportationRepair[]
  breakdowns               TransportationBreakdown[]
  sparePRs                 TransportationSparePR[]
}

enum TransportationStatus {
  Working
  Idle
  Breakdown
}

model TransportationAssignment {
  id               Int            @id @default(autoincrement())
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  userId           Int
  user             User           @relation(fields: [userId], references: [id])
  transportationId Int
  transportation   Transportation @relation(fields: [transportationId], references: [id], onDelete: Cascade)

  @@unique([userId, transportationId])
}

model TransportationChecklistItem {
  id               Int            @id @default(autoincrement())
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  transportationId Int
  transportation   Transportation @relation(fields: [transportationId], references: [id], onDelete: Cascade)
  description      String
  completedById    Int?
  completedBy      User?          @relation(fields: [completedById], references: [id])
  completedAt      DateTime?
  type             String         @default("Daily")
}

model TransportationPeriodicMaintenance {
  id                   Int                       @id @default(autoincrement())
  createdAt            DateTime                  @default(now())
  updatedAt            DateTime                  @updatedAt
  transportationId     Int
  transportation       Transportation            @relation(fields: [transportationId], references: [id], onDelete: Cascade)
  title                String
  description          String
  period               Int?
  notificationReminder Int?
  fixedDate            DateTime?
  completedById        Int?
  completedBy          User?                     @relation(fields: [completedById], references: [id])
  completedAt          DateTime?
  status               PeriodicMaintenanceStatus @default(Pending)
}

model TransportationAttachment {
  id                 Int            @id @default(autoincrement())
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  userId             Int
  user               User           @relation(fields: [userId], references: [id])
  transportationId   Int
  transportation     Transportation @relation(fields: [transportationId], references: [id], onDelete: Cascade)
  description        String
  mimeType           String?
  originalName       String?
  sharepointFileName String?
  mode               String         @default("Public")
}

model TransportationHistory {
  id                   Int                   @id @default(autoincrement())
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  transportationId     Int
  transportation       Transportation        @relation(fields: [transportationId], references: [id], onDelete: Cascade)
  completedById        Int?
  completedBy          User?                 @relation(fields: [completedById], references: [id])
  type                 String
  description          String
  transportationStatus TransportationStatus?
  transportationType   String?
  currentMileage       Int?
  lastServiceMileage   Int?
  interServiceMileage  Int?
}

model TransportationRepair {
  id               Int            @id @default(autoincrement())
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  transportationId Int
  transportation   Transportation @relation(fields: [transportationId], references: [id], onDelete: Cascade)
  title            String
  description      String
  completedById    Int?
  completedBy      User?          @relation(fields: [completedById], references: [id])
  completedAt      DateTime?
  status           RepairStatus   @default(Pending)
}

model TransportationBreakdown {
  id               Int             @id @default(autoincrement())
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  transportationId Int
  transportation   Transportation  @relation(fields: [transportationId], references: [id], onDelete: Cascade)
  title            String
  description      String
  completedById    Int?
  completedBy      User?           @relation(fields: [completedById], references: [id])
  completedAt      DateTime?
  status           BreakdownStatus @default(Breakdown)
}

model TransportationSparePR {
  id               Int            @id @default(autoincrement())
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  transportationId Int
  transportation   Transportation @relation(fields: [transportationId], references: [id], onDelete: Cascade)
  requestedDate    DateTime
  title            String
  description      String
  completedById    Int?
  completedBy      User?          @relation(fields: [completedById], references: [id])
  completedAt      DateTime?
  status           SparePRStatus  @default(Pending)
}
